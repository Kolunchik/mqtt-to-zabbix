<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>4.4</version>
    <date>2020-03-17T10:53:58Z</date>
    <groups>
        <group>
            <name>Templates</name>
        </group>
        <group>
            <name>Templates/MQTT</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template MQTT</template>
            <name>Template MQTT</name>
            <groups>
                <group>
                    <name>Templates</name>
                </group>
                <group>
                    <name>Templates/MQTT</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>CO2</name>
                </application>
                <application>
                    <name>RGB</name>
                </application>
                <application>
                    <name>влажность</name>
                </application>
                <application>
                    <name>комфорт</name>
                </application>
                <application>
                    <name>оповещение</name>
                </application>
                <application>
                    <name>осадки</name>
                </application>
                <application>
                    <name>освещённость</name>
                </application>
                <application>
                    <name>питание датчиков</name>
                </application>
                <application>
                    <name>реле</name>
                </application>
                <application>
                    <name>состояние датчиков</name>
                </application>
                <application>
                    <name>сухие контакты</name>
                </application>
                <application>
                    <name>счетчики</name>
                </application>
                <application>
                    <name>счётчики на сухих контактах</name>
                </application>
                <application>
                    <name>счётчики электричества</name>
                </application>
                <application>
                    <name>таймеры безопасности</name>
                </application>
                <application>
                    <name>температура</name>
                </application>
                <application>
                    <name>уровень шума</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>{$N_MQTT}: время после перезагрузки</name>
                    <type>TRAP</type>
                    <key>system[system/controls/uptime]</key>
                    <delay>0</delay>
                    <history>{$ERR_HISTORY}</history>
                    <trends>{$ERR_TREND}</trends>
                    <value_type>FLOAT</value_type>
                    <units>uptime</units>
                    <applications>
                        <application>
                            <name>состояние датчиков</name>
                        </application>
                    </applications>
                    <request_method>POST</request_method>
                    <triggers>
                        <trigger>
                            <expression>{last(#1)}&lt;{last(#2)}</expression>
                            <name>{$N_MQTT}: split-brain у mqtt-брокеров</name>
                            <priority>INFO</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>{$N_MQTT}: устройство было перезагружено</name>
                                    <expression>{Template MQTT:system[system/controls/uptime].last()}&lt;{$CHECK_NODATA:UPTIME}</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{$N_MQTT}</value>
                                </tag>
                                <tag>
                                    <tag>muted</tag>
                                </tag>
                            </tags>
                        </trigger>
                        <trigger>
                            <expression>{nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                            <name>{$N_MQTT}: давно не поступали данные</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                            <tags>
                                <tag>
                                    <tag>error</tag>
                                    <value>nodata</value>
                                </tag>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{$N_MQTT}</value>
                                </tag>
                            </tags>
                        </trigger>
                        <trigger>
                            <expression>({count({$CHECK_NODATA:UPTIME})}&gt;1) and ({delta({$CHECK_NODATA:UPTIME})}=0)</expression>
                            <name>{$N_MQTT}: поступают одинаковые данные</name>
                            <priority>WARNING</priority>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>{$N_MQTT}: давно не поступали данные</name>
                                    <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{$N_MQTT}</value>
                                </tag>
                            </tags>
                        </trigger>
                        <trigger>
                            <expression>{last()}&lt;{$CHECK_NODATA:UPTIME}</expression>
                            <name>{$N_MQTT}: устройство было перезагружено</name>
                            <manual_close>YES</manual_close>
                            <dependencies>
                                <dependency>
                                    <name>{$N_MQTT}: поступают одинаковые данные</name>
                                    <expression>({Template MQTT:system[system/controls/uptime].count({$CHECK_NODATA:UPTIME})}&gt;1) and ({Template MQTT:system[system/controls/uptime].delta({$CHECK_NODATA:UPTIME})}=0)</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{$N_MQTT}</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>{$N_MQTT}: напряжение питания контроллера</name>
                    <type>TRAP</type>
                    <key>wb-adc[wb-adc/controls/Vin]</key>
                    <delay>0</delay>
                    <history>{$ERR_HISTORY}</history>
                    <trends>{$ERR_TREND}</trends>
                    <value_type>FLOAT</value_type>
                    <units>V</units>
                    <applications>
                        <application>
                            <name>питание датчиков</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                            <params>60</params>
                        </step>
                    </preprocessing>
                    <triggers>
                        <trigger>
                            <expression>{count({$CHECK_INTERVAL})}&gt;1 and {delta({$CHECK_INTERVAL})}=0</expression>
                            <name>{$N_MQTT}: давно не изменялось значение напряжения питания контроллера</name>
                            <priority>INFO</priority>
                            <dependencies>
                                <dependency>
                                    <name>{$N_MQTT}: давно не поступали данные</name>
                                    <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{$N_MQTT}</value>
                                </tag>
                            </tags>
                        </trigger>
                        <trigger>
                            <expression>{avg({$CHECK_INTERVAL_SHORT})}&lt;{$VOLTAGE_MIN}</expression>
                            <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                            <recovery_expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$VOLTAGE_MIN_OK}</recovery_expression>
                            <name>{$N_MQTT}: напряжение питания контроллера ниже {$VOLTAGE_MIN} V</name>
                            <priority>INFO</priority>
                            <dependencies>
                                <dependency>
                                    <name>{$N_MQTT}: давно не изменялось значение напряжения питания контроллера</name>
                                    <expression>{Template MQTT:wb-adc[wb-adc/controls/Vin].count({$CHECK_INTERVAL})}&gt;1 and {Template MQTT:wb-adc[wb-adc/controls/Vin].delta({$CHECK_INTERVAL})}=0</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{$N_MQTT}</value>
                                </tag>
                            </tags>
                        </trigger>
                    </triggers>
                </item>
            </items>
            <discovery_rules>
                <discovery_rule>
                    <name>msu24hit</name>
                    <type>TRAP</type>
                    <key>msu24hit.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: влажность</name>
                            <type>TRAP</type>
                            <key>msu24hit[{#DEVICE}/controls/Humidity]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>влажность</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$HUMID_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$HUMID_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокая влажность</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>humid</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: освещённость</name>
                            <type>TRAP</type>
                            <key>msu24hit[{#DEVICE}/controls/Illuminance]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <units>lx</units>
                            <applications>
                                <application>
                                    <name>освещённость</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>msu24hit[{#DEVICE}/controls/Temperature/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}: {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>msu24hit[{#DEVICE}/controls/Temperature]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>mth</name>
                    <type>TRAP</type>
                    <key>mth.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: влажность</name>
                            <type>TRAP</type>
                            <key>mth[{#DEVICE}/controls/Humidity]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>влажность</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$HUMID_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$HUMID_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокая влажность</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>humid</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>mth[{#DEVICE}/controls/Temperature/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>mth[{#DEVICE}/controls/Temperature]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>C</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>oregon</name>
                    <type>TRAP</type>
                    <key>oregon.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <description>Находит устройства Oregon</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: комфорт</name>
                            <type>TRAP</type>
                            <key>oregon[{#DEVICE}/controls/comfort]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <applications>
                                <application>
                                    <name>комфорт</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: влажность</name>
                            <type>TRAP</type>
                            <key>oregon[{#DEVICE}/controls/humidity]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>влажность</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$HUMID_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$HUMID_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокая влажность</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>humid</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: села батарейка</name>
                            <type>TRAP</type>
                            <key>oregon[{#DEVICE}/controls/low_battery]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{min({$CHECK_INTERVAL})}=1</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{max({$CHECK_INTERVAL})}=0</recovery_expression>
                                    <name>{${#MACRO}}: пора заменить батарейку</name>
                                    <priority>INFO</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>battery</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: осадки</name>
                            <type>TRAP</type>
                            <key>oregon[{#DEVICE}/controls/rain_rate]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <applications>
                                <application>
                                    <name>осадки</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: осадки (сч.)</name>
                            <type>TRAP</type>
                            <key>oregon[{#DEVICE}/controls/rain_total]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <applications>
                                <application>
                                    <name>осадки</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>oregon[{#DEVICE}/controls/temperature]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>C</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>({Template MQTT:oregon[{#DEVICE}/controls/temperature].nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1) and {Template MQTT:oregon[{#DEVICE}/controls/rain_total].nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                            <name>{${#MACRO}}: давно не поступали данные</name>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>{$N_MQTT}: давно не поступали данные</name>
                                    <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                </dependency>
                            </dependencies>
                            <tags>
                                <tag>
                                    <tag>error</tag>
                                    <value>nodata</value>
                                </tag>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>tomzn</name>
                    <type>TRAP</type>
                    <key>tomzn.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: активная мощность</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/ActivePower]</key>
                            <delay>0</delay>
                            <history>{$POWER_HISTORY}</history>
                            <trends>{$POWER_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>kW</units>
                            <applications>
                                <application>
                                    <name>счётчики электричества</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: сила тока</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/Current]</key>
                            <delay>0</delay>
                            <history>{$POWER_HISTORY}</history>
                            <trends>{$POWER_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>A</units>
                            <applications>
                                <application>
                                    <name>счётчики электричества</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/ImportEnergy/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: показания счетчика</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/ImportEnergy]</key>
                            <delay>0</delay>
                            <history>{$POWER_HISTORY}</history>
                            <trends>{$POWER_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>!kWh</units>
                            <applications>
                                <application>
                                    <name>счётчики электричества</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: коэффициент мощности</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/PowerFactor]</key>
                            <delay>0</delay>
                            <history>{$POWER_HISTORY}</history>
                            <trends>{$POWER_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <applications>
                                <application>
                                    <name>счётчики электричества</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: реактивная мощность</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/ReactivePower]</key>
                            <delay>0</delay>
                            <history>{$POWER_HISTORY}</history>
                            <trends>{$POWER_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>kVAR</units>
                            <applications>
                                <application>
                                    <name>счётчики электричества</name>
                                </application>
                            </applications>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: входное напряжение</name>
                            <type>TRAP</type>
                            <key>tomzn[{#DEVICE}/controls/Voltage]</key>
                            <delay>0</delay>
                            <history>{$POWER_HISTORY}</history>
                            <trends>{$POWER_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>счётчики электричества</name>
                                </application>
                            </applications>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$POWER_VOLTAGE_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL_SHORT})}&lt;{$POWER_VOLTAGE_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокое напряжение</name>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>voltage</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL_SHORT})}&lt;{$POWER_VOLTAGE_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$POWER_VOLTAGE_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: низкое напряжение</name>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>voltage</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-mcm16</name>
                    <type>TRAP</type>
                    <key>wb-mcm16.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I1} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 1]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I2} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 2]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I3} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 3]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I4} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 4]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I5} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 5]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I6} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 6]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I7} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 7]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I8} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 8]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I9} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 9]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I10} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 10]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I11} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 11]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I12} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 12]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I13} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 13]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I14} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 14]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{delta(5h)}=0</expression>
                                    <name>{${#MACRO}}: давно не изменялось значение {${#MACRO}:I14} (сч.)</name>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>notest</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I15} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 15]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I16} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Counter 16]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 1/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}:  {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 1]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{$EVENT_DRIVEN}=0 and {nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 2]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 3]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I4}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 4]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I4}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I5}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 5]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I5}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I6}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 6]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I6}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I7}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 7]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I7}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I8}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 8]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I8}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I9}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 9]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I9}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I10}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 10]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I10}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I11}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 11]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I11}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I12}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 12]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I12}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I13}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 13]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I13}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I14}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 14]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I14}</name>
                                    <status>DISABLED</status>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{delta(5h)}=0</expression>
                                    <name>{${#MACRO}}: давно не включался {${#MACRO}:I14}</name>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>notest</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I15}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 15]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I15}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I16}</name>
                            <type>TRAP</type>
                            <key>wb-mcm16[{#DEVICE}/controls/Input 16]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I16}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: напряжение питания датчика</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input Voltage]</key>
                            <delay>0</delay>
                            <history>{$VOLTAGE_HISTORY}</history>
                            <trends>{$VOLTAGE_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 1].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 1].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 2].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 2].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 3].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 3].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 4].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 4].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I4}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 5].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 5].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I5}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 6].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 6].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I6}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 7].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 7].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I7}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 8].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 8].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I8}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 9].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 9].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I9}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 10].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 10].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I10}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 11].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 11].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I11}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 12].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 12].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I12}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 13].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 13].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I13}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 14].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 14].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I14}</name>
                            <status>DISABLED</status>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 15].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 15].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I15}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Counter 16].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mcm16[{#DEVICE}/controls/Input 16].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I16}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-mr3</name>
                    <type>TRAP</type>
                    <key>wb-mr3.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I1} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 1 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 1/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}:  {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 1]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I2} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 2 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 2]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I3} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 3 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Input 3]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K1}</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/K1]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K2}</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/K2]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K3}</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/K3]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: таймер безопасности</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Safety Timer]</key>
                            <delay>0</delay>
                            <history>{$SAFE_HISTORY}</history>
                            <trends>{$SAFE_TREND}</trends>
                            <applications>
                                <application>
                                    <name>таймеры безопасности</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: напряжение питания датчика</name>
                            <type>TRAP</type>
                            <key>wb-mr3[{#DEVICE}/controls/Supply voltage]</key>
                            <delay>0</delay>
                            <history>{$VOLTAGE_HISTORY}</history>
                            <trends>{$VOLTAGE_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{$EVENT_DRIVEN}=0 and {nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr3[{#DEVICE}/controls/Input 1 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr3[{#DEVICE}/controls/Input 1].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr3[{#DEVICE}/controls/Input 2 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr3[{#DEVICE}/controls/Input 2].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr3[{#DEVICE}/controls/Input 3 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr3[{#DEVICE}/controls/Input 3].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-mr11</name>
                    <type>TRAP</type>
                    <key>wb-mr11.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I1} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 1 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 1/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}:  {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 1]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I2} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 2 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 2]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I3} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 3 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 3]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I4} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 4 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I4}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 4]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I4}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I5} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 5 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I5}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 5]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I5}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I6} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 6 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I6}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 6]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I6}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I7} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 7 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I7}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 7]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I7}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I8} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 8 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I8}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 8]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I8}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I9} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 9 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I9}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 9]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I9}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I10} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 10 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I10}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 10]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I10}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I11} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 11 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:I11}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Input 11]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: {${#MACRO}:I11}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K1}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K1]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K2}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K2]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K3}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K3]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K4}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K4]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K5}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K5]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K6}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K6]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K7}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K7]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K8}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K8]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K9}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K9]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K10}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K10]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:K11}</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/K11]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: таймер безопасности</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Safety Timer]</key>
                            <delay>0</delay>
                            <history>{$SAFE_HISTORY}</history>
                            <trends>{$SAFE_TREND}</trends>
                            <applications>
                                <application>
                                    <name>таймеры безопасности</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: напряжение питания датчика</name>
                            <type>TRAP</type>
                            <key>wb-mr11[{#DEVICE}/controls/Supply voltage]</key>
                            <delay>0</delay>
                            <history>{$VOLTAGE_HISTORY}</history>
                            <trends>{$VOLTAGE_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{$EVENT_DRIVEN}=0 and {nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <trigger_prototypes>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 1 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 1].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I1}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 2 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 2].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I2}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 3 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 3].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I3}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 4 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 4].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I4}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 5 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 5].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I5}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 6 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 6].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I6}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 7 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 7].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I7}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 8 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 8].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I8}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 9 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 9].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I9}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 10 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 10].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I10}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                        <trigger_prototype>
                            <expression>{$EVENT_DRIVEN}=0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 11 counter].delta({$EVENT_INTERVAL})}&lt;&gt;0 and {Template MQTT:wb-mr11[{#DEVICE}/controls/Input 11].max({$EVENT_INTERVAL})}=0</expression>
                            <name>{${#MACRO}}: {${#MACRO}:I11}</name>
                            <priority>WARNING</priority>
                            <tags>
                                <tag>
                                    <tag>mqtt</tag>
                                    <value>{#DEVICE}</value>
                                </tag>
                                <tag>
                                    <tag>short</tag>
                                </tag>
                            </tags>
                        </trigger_prototype>
                    </trigger_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-mrgb</name>
                    <type>TRAP</type>
                    <key>wb-mrgb.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B1} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mrgb[{#DEVICE}/controls/Button 1 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-mrgb[{#DEVICE}/controls/Button 1/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}:  {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B1}</name>
                            <type>TRAP</type>
                            <key>wb-mrgb[{#DEVICE}/controls/Button 1]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{$EVENT_DRIVEN}=0 and {nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B2} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mrgb[{#DEVICE}/controls/Button 2 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B2}</name>
                            <type>TRAP</type>
                            <key>wb-mrgb[{#DEVICE}/controls/Button 2]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:RGB}</name>
                            <type>TRAP</type>
                            <key>wb-mrgb[{#DEVICE}/controls/RGB]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>0</trends>
                            <value_type>CHAR</value_type>
                            <applications>
                                <application>
                                    <name>RGB</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-mrm2</name>
                    <type>TRAP</type>
                    <key>wb-mrm2.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B1} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Button 1 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Button 1/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}:  {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B1}</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Button 1]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{$EVENT_DRIVEN}=0 and {nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B2} (сч.)</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Button 2 counter]</key>
                            <delay>0</delay>
                            <history>{$COUNTER_HISTORY}</history>
                            <trends>{$COUNTER_TREND}</trends>
                            <applications>
                                <application>
                                    <name>счётчики на сухих контактах</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:B2}</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Button 2]</key>
                            <delay>0</delay>
                            <history>{$INPUT_HISTORY}</history>
                            <trends>{$INPUT_TREND}</trends>
                            <applications>
                                <application>
                                    <name>сухие контакты</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:R1}</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Relay 1]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: {${#MACRO}:R2}</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Relay 2]</key>
                            <delay>0</delay>
                            <history>{$RELAY_HISTORY}</history>
                            <trends>{$RELAY_TREND}</trends>
                            <applications>
                                <application>
                                    <name>реле</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttDryInput</name>
                            </valuemap>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: таймер безопасности</name>
                            <type>TRAP</type>
                            <key>wb-mrm2[{#DEVICE}/controls/Safety Timer]</key>
                            <delay>0</delay>
                            <history>{$SAFE_HISTORY}</history>
                            <trends>{$SAFE_TREND}</trends>
                            <applications>
                                <application>
                                    <name>таймеры безопасности</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-ms-thls-v2</name>
                    <type>TRAP</type>
                    <key>wb-ms-thls-v2.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: температура {${#MACRO}:W1}</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/External Sensor 1]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}_W1&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}_W1&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко {${#MACRO}:W1}</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}_W1&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}_W1&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно {${#MACRO}:W1}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура {${#MACRO}:W2}</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/External Sensor 2]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}_W2&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}_W2&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко {${#MACRO}:W2}</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}_W2&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}_W2&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно {${#MACRO}:W2}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: влажность</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/Humidity]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>влажность</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$HUMID_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$HUMID_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокая влажность</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>humid</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: освещённость</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/Illuminance]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <units>lx</units>
                            <applications>
                                <application>
                                    <name>освещённость</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: напряжение питания датчика</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/Input Voltage]</key>
                            <delay>0</delay>
                            <history>{$VOLTAGE_HISTORY}</history>
                            <trends>{$VOLTAGE_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: уровень шума</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/Sound Level]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>dB</units>
                            <applications>
                                <application>
                                    <name>уровень шума</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
200</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$LOUD_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <name>{${#MACRO}}: шумно</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>loud</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/Temperature/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}: {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls-v2[{#DEVICE}/controls/Temperature]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-ms-thls</name>
                    <type>TRAP</type>
                    <key>wb-ms-thls.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: влажность</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls[{#DEVICE}/controls/Humidity]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>влажность</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$HUMID_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$HUMID_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокая влажность</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>humid</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: освещённость</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls[{#DEVICE}/controls/Illuminance]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <units>lx</units>
                            <applications>
                                <application>
                                    <name>освещённость</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: напряжение питания датчика</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls[{#DEVICE}/controls/Input Voltage]</key>
                            <delay>0</delay>
                            <history>{$VOLTAGE_HISTORY}</history>
                            <trends>{$VOLTAGE_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: уровень шума</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls[{#DEVICE}/controls/Sound Level]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>dB</units>
                            <applications>
                                <application>
                                    <name>уровень шума</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
200</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$LOUD_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <name>{${#MACRO}}: шумно</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>loud</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls[{#DEVICE}/controls/Temperature/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}: {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>wb-ms-thls[{#DEVICE}/controls/Temperature]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>C</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-msw2</name>
                    <type>TRAP</type>
                    <key>wb-msw2.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: зуммер</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Buzzer]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <applications>
                                <application>
                                    <name>оповещение</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>BOOL_TO_DECIMAL</type>
                                    <params/>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}=1</expression>
                                    <name>{${#MACRO}}: зуммер включен</name>
                                    <tags>
                                        <tag>
                                            <tag>buzzer</tag>
                                            <value>on</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: содержание углекислого газа</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/CO2]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <units>ppm</units>
                            <applications>
                                <application>
                                    <name>CO2</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$CO2_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <name>{${#MACRO}}: высокое содержание углекислого газа</name>
                                    <priority>WARNING</priority>
                                    <tags>
                                        <tag>
                                            <tag>CO2</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура {${#MACRO}:W1}</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/External Sensor 1]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}_W1&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}_W1&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко {${#MACRO}:W1}</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}_W1&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}_W1&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно {${#MACRO}:W1}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура {${#MACRO}:W2}</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/External Sensor 2]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}_W2&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}_W2&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко {${#MACRO}:W2}</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}_W2&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}_W2&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно {${#MACRO}:W2}</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: влажность</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Humidity]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>%</units>
                            <applications>
                                <application>
                                    <name>влажность</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$HUMID_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$HUMID_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: высокая влажность</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>humid</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: освещённость</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Illuminance]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <units>lx</units>
                            <applications>
                                <application>
                                    <name>освещённость</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: напряжение питания датчика</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Input Voltage]</key>
                            <delay>0</delay>
                            <history>{$VOLTAGE_HISTORY}</history>
                            <trends>{$VOLTAGE_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>V</units>
                            <applications>
                                <application>
                                    <name>питание датчиков</name>
                                </application>
                            </applications>
                            <request_method>POST</request_method>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: уровень шума</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Sound Level]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>dB</units>
                            <applications>
                                <application>
                                    <name>уровень шума</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>0
200</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL_SHORT})}&gt;{$LOUD_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <name>{${#MACRO}}: шумно</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>loud</tag>
                                            <value>high</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: ошибки связи</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Temperature/meta/error]</key>
                            <delay>0</delay>
                            <history>{$ERR_HISTORY}</history>
                            <trends>{$ERR_TREND}</trends>
                            <applications>
                                <application>
                                    <name>состояние датчиков</name>
                                </application>
                            </applications>
                            <valuemap>
                                <name>mqttErrors</name>
                            </valuemap>
                            <preprocessing>
                                <step>
                                    <type>REGEX</type>
                                    <params>(.*)
\1:=0:r=1:w=2:rw=3:wr=3</params>
                                </step>
                                <step>
                                    <type>REGEX</type>
                                    <params>(r|w|rw|wr|)(?=.*:\1=(\d))
\2</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{last()}&gt;0</expression>
                                    <name>{${#MACRO}}: {ITEM.VALUE1}</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <tags>
                                        <tag>
                                            <tag>deferred</tag>
                                        </tag>
                                        <tag>
                                            <tag>error</tag>
                                            <value>rw</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>wb-msw2[{#DEVICE}/controls/Temperature]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
                <discovery_rule>
                    <name>wb-w1</name>
                    <type>TRAP</type>
                    <key>wb-w1.lld</key>
                    <delay>0</delay>
                    <lifetime>{$LLD_LOST}</lifetime>
                    <description>Находит устройства на шине W1</description>
                    <item_prototypes>
                        <item_prototype>
                            <name>{${#MACRO}}: температура</name>
                            <type>TRAP</type>
                            <key>wb-w1[wb-w1/controls/{#DEVICE}]</key>
                            <delay>0</delay>
                            <history>{$W_HISTORY}</history>
                            <trends>{$W_TREND}</trends>
                            <value_type>FLOAT</value_type>
                            <units>С</units>
                            <applications>
                                <application>
                                    <name>температура</name>
                                </application>
                            </applications>
                            <preprocessing>
                                <step>
                                    <type>IN_RANGE</type>
                                    <params>-100
100</params>
                                </step>
                                <step>
                                    <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                                    <params>{$HB_INTERVAL}</params>
                                </step>
                            </preprocessing>
                            <request_method>POST</request_method>
                            <trigger_prototypes>
                                <trigger_prototype>
                                    <expression>{nodata({$CHECK_NODATA:&quot;{#DEVICE}&quot;})}=1</expression>
                                    <name>{${#MACRO}}: давно не поступали данные</name>
                                    <priority>WARNING</priority>
                                    <manual_close>YES</manual_close>
                                    <dependencies>
                                        <dependency>
                                            <name>{$N_MQTT}: давно не поступали данные</name>
                                            <expression>{Template MQTT:system[system/controls/uptime].nodata({$CHECK_NODATA:UPTIME})}=1</expression>
                                        </dependency>
                                    </dependencies>
                                    <tags>
                                        <tag>
                                            <tag>error</tag>
                                            <value>nodata</value>
                                        </tag>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MAX:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MAX_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: жарко</name>
                                    <priority>INFO</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>high</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                                <trigger_prototype>
                                    <expression>{avg({$CHECK_INTERVAL})}&lt;{$TEMP_MIN:&quot;{#DEVICE}&quot;}</expression>
                                    <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                                    <recovery_expression>{avg({$CHECK_INTERVAL})}&gt;{$TEMP_MIN_OK:&quot;{#DEVICE}&quot;}</recovery_expression>
                                    <name>{${#MACRO}}: холодно</name>
                                    <priority>AVERAGE</priority>
                                    <tags>
                                        <tag>
                                            <tag>mqtt</tag>
                                            <value>{#DEVICE}</value>
                                        </tag>
                                        <tag>
                                            <tag>temp</tag>
                                            <value>low</value>
                                        </tag>
                                    </tags>
                                </trigger_prototype>
                            </trigger_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <request_method>POST</request_method>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$CHECK_INTERVAL}</macro>
                    <value>30m</value>
                    <description>отрезки времени для обычных проверок (температура, влажность)</description>
                </macro>
                <macro>
                    <macro>{$CHECK_INTERVAL_SHORT}</macro>
                    <value>5m</value>
                    <description>отрезки времени для быстрых проверок (напряжение в электросети, CO2, уровень шума)</description>
                </macro>
                <macro>
                    <macro>{$CHECK_NODATA}</macro>
                    <value>10m</value>
                    <description>допустимый отрезок времени без новых данных</description>
                </macro>
                <macro>
                    <macro>{$CHECK_NODATA:UPTIME}</macro>
                    <value>9m</value>
                    <description>допустимый отрезок времени без новых данных о времени работы устройства после загрузки</description>
                </macro>
                <macro>
                    <macro>{$CO2_MAX}</macro>
                    <value>1000</value>
                    <description>максимальный уровень CO2</description>
                </macro>
                <macro>
                    <macro>{$COUNTER_HISTORY}</macro>
                    <value>14d</value>
                    <description>история счётчиков сухих входов</description>
                </macro>
                <macro>
                    <macro>{$COUNTER_TREND}</macro>
                    <value>30d</value>
                    <description>тренды счётчиков сухих входов</description>
                </macro>
                <macro>
                    <macro>{$ERR_HISTORY}</macro>
                    <value>7d</value>
                    <description>история ошибок связи</description>
                </macro>
                <macro>
                    <macro>{$ERR_TREND}</macro>
                    <value>14d</value>
                    <description>тренды ошибок связи</description>
                </macro>
                <macro>
                    <macro>{$EVENT_DRIVEN}</macro>
                    <value>1</value>
                    <description>0 - данные приходят по таймеру периодически, 1 - данные приходят в момент события однократно</description>
                </macro>
                <macro>
                    <macro>{$EVENT_INTERVAL}</macro>
                    <value>5m</value>
                    <description>отрезок времени для отслеживания краткосрочных срабатываний сухих входов</description>
                </macro>
                <macro>
                    <macro>{$HB_INTERVAL}</macro>
                    <value>3m</value>
                    <description>heartbeat интервал при сохранении повторяющихся данных</description>
                </macro>
                <macro>
                    <macro>{$HUMID_MAX}</macro>
                    <value>62</value>
                    <description>максимальная влажность, сработка</description>
                </macro>
                <macro>
                    <macro>{$HUMID_MAX_OK}</macro>
                    <value>60</value>
                    <description>максимальная влажность, покой</description>
                </macro>
                <macro>
                    <macro>{$INPUT_HISTORY}</macro>
                    <value>14d</value>
                    <description>история  сухих входов</description>
                </macro>
                <macro>
                    <macro>{$INPUT_TREND}</macro>
                    <value>30d</value>
                    <description>тренды  сухих входов</description>
                </macro>
                <macro>
                    <macro>{$LLD_LOST}</macro>
                    <value>3d</value>
                    <description>сколько хранить данные об устройствах, потерянных во время процесса LLD</description>
                </macro>
                <macro>
                    <macro>{$LOUD_MAX}</macro>
                    <value>75</value>
                    <description>максимальный уровень шума</description>
                </macro>
                <macro>
                    <macro>{$N_MQTT}</macro>
                    <value>WirenBoard</value>
                    <description>понятное название WirenBoard</description>
                </macro>
                <macro>
                    <macro>{$N_MSU24HIT_5}</macro>
                    <value>MSU24HIT_5</value>
                    <description>понятное название датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1}</macro>
                    <value>WB_MCM16_1</value>
                    <description>понятное название датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I1}</macro>
                    <value>утечка газа</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I2}</macro>
                    <value>минимальное давление газа</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I3}</macro>
                    <value>авария котла</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I4}</macro>
                    <value>авария глубинного насоса</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I5}</macro>
                    <value>минимальное давление воды</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I6}</macro>
                    <value>протечка воды</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I7}</macro>
                    <value>авария приточно-вытяжной вентиляции</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I8}</macro>
                    <value>(резерв)</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I9}</macro>
                    <value>(резерв)</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I10}</macro>
                    <value>(резерв)</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I11}</macro>
                    <value>(резерв)</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I12}</macro>
                    <value>(резерв)</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I13}</macro>
                    <value>(резерв)</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I14}</macro>
                    <value>автотест</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I15}</macro>
                    <value>отсутствие входящей электроэнергии</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MCM16_1:I16}</macro>
                    <value>работает генератор</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MSW2_3}</macro>
                    <value>WB_MSW2_3</value>
                    <description>понятное название датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MSW2_3:W1}</macro>
                    <value>первый W1 датчик</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MSW2_3:W2}</macro>
                    <value>второй W1 датчик</value>
                    <description>понятное название входа датчика</description>
                </macro>
                <macro>
                    <macro>{$N_WB_MS_THLS_2}</macro>
                    <value>WB_MS_THLS_2</value>
                    <description>понятное название датчика</description>
                </macro>
                <macro>
                    <macro>{$POWER_HISTORY}</macro>
                    <value>30d</value>
                    <description>история, электросчётчики</description>
                </macro>
                <macro>
                    <macro>{$POWER_TREND}</macro>
                    <value>90d</value>
                    <description>тренды, электросчётчики</description>
                </macro>
                <macro>
                    <macro>{$POWER_VOLTAGE_MAX}</macro>
                    <value>250</value>
                    <description>максимальное напряжение, сработка</description>
                </macro>
                <macro>
                    <macro>{$POWER_VOLTAGE_MAX_OK}</macro>
                    <value>240</value>
                    <description>максимальное напряжение, покой</description>
                </macro>
                <macro>
                    <macro>{$POWER_VOLTAGE_MIN}</macro>
                    <value>190</value>
                    <description>минимальное напряжение, сработка</description>
                </macro>
                <macro>
                    <macro>{$POWER_VOLTAGE_MIN_OK}</macro>
                    <value>200</value>
                    <description>минимальное напряжение, покой</description>
                </macro>
                <macro>
                    <macro>{$RELAY_HISTORY}</macro>
                    <value>7d</value>
                    <description>история, контакты реле</description>
                </macro>
                <macro>
                    <macro>{$RELAY_TREND}</macro>
                    <value>14d</value>
                    <description>тренды, контакты реле</description>
                </macro>
                <macro>
                    <macro>{$SAFE_HISTORY}</macro>
                    <value>1d</value>
                    <description>история, таймеры безопасности</description>
                </macro>
                <macro>
                    <macro>{$SAFE_TREND}</macro>
                    <value>2d</value>
                    <description>тренды, таймеры безопасности</description>
                </macro>
                <macro>
                    <macro>{$TEMP_MAX}</macro>
                    <value>40</value>
                    <description>максимальная температура, сработка</description>
                </macro>
                <macro>
                    <macro>{$TEMP_MAX_OK}</macro>
                    <value>38</value>
                    <description>максимальная температура, покой</description>
                </macro>
                <macro>
                    <macro>{$TEMP_MIN}</macro>
                    <value>13</value>
                    <description>минимальная температура, сработка</description>
                </macro>
                <macro>
                    <macro>{$TEMP_MIN_OK}</macro>
                    <value>15</value>
                    <description>минимальная температура, покой</description>
                </macro>
                <macro>
                    <macro>{$VOLTAGE_HISTORY}</macro>
                    <value>1d</value>
                    <description>история напряжения питания датчиков</description>
                </macro>
                <macro>
                    <macro>{$VOLTAGE_MIN}</macro>
                    <value>10</value>
                    <description>минимальное напряжение питания датчиков, сработка</description>
                </macro>
                <macro>
                    <macro>{$VOLTAGE_MIN_OK}</macro>
                    <value>11</value>
                    <description>минимальное напряжение питания датчиков, покой</description>
                </macro>
                <macro>
                    <macro>{$VOLTAGE_TREND}</macro>
                    <value>2d</value>
                    <description>тренды напряжения питания датчиков</description>
                </macro>
                <macro>
                    <macro>{$W_HISTORY}</macro>
                    <value>30d</value>
                    <description>история погоды</description>
                </macro>
                <macro>
                    <macro>{$W_TREND}</macro>
                    <value>90d</value>
                    <description>тренды погоды</description>
                </macro>
            </macros>
        </template>
    </templates>
    <value_maps>
        <value_map>
            <name>mqttDryInput</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>Разомкнут</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>Замкнут</newvalue>
                </mapping>
            </mappings>
        </value_map>
        <value_map>
            <name>mqttErrors</name>
            <mappings>
                <mapping>
                    <newvalue>нет ошибок</newvalue>
                </mapping>
                <mapping>
                    <value>0</value>
                    <newvalue>нет ошибок</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>ошибка чтения</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>ошибка записи</newvalue>
                </mapping>
                <mapping>
                    <value>3</value>
                    <newvalue>ошибка чтения/записи</newvalue>
                </mapping>
                <mapping>
                    <value>r</value>
                    <newvalue>ошибка чтения</newvalue>
                </mapping>
                <mapping>
                    <value>rw</value>
                    <newvalue>ошибка чтения/записи</newvalue>
                </mapping>
                <mapping>
                    <value>w</value>
                    <newvalue>ошибка записи</newvalue>
                </mapping>
            </mappings>
        </value_map>
    </value_maps>
</zabbix_export>
